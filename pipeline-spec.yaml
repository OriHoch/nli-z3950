load_marc_data:
  pipeline:
  - run: load_marc_data
  - run: dump.to_path
    parameters:
      out-path: data/load_marc_data


get_ccl_queries_from_lc_topics:
  pipeline:
  - run: add_resource
    parameters:
      name: topics
      url: data/topics.xlsx
      format: xlsx
      sheet: "LC"
  - run: stream_remote_resources
  - run: topics_to_ccl_queries
  - run: dump.to_path
    parameters:
      out-path: data/ccl_queries
      resources: .*


search:
  pipeline:
  - run: load_resource
    parameters:
      url: data/search_results/datapackage.json
      resource: unique_records
  - run: load_resource
    parameters:
      url: data/search_results/datapackage.json
      resource: query_stats
  - run: load_resource
    parameters:
      url: data/ccl_queries/datapackage.json
      resource: ccl_queries
  - run: search
  - run: dump.to_path
    parameters:
      out-path: data/search_results


search_export:
  pipeline:
  - run: load_resource
    parameters:
      url: data/search_results/datapackage.json
      resource: unique_records
  - run: search_filter
    parameters:
      min_year: 2005
  - run: search_export
    parameters:
      export_keys:
      - 'title'
      - 'pubyear'
      - 'publisher'
      - 'uniformtitle'
      - 'author'
      - 'isbn'
      - 'language_code'
      - 'custom_metadata'
      - 'publication_distribution_details'
      - 'physical_description'
      - 'notes'
      - 'tags'
      - 'url'
      - 'migdar_id'
  - run: dump.to_path
    parameters:
      out-path: data/search_export
